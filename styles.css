* {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Arial Rounded MT Bold', cursive, sans-serif;
            background: linear-gradient(135deg, #a8c0ff 0%, #c8b3ff 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            background: white;
            border-radius: 30px;
            padding: 40px;
            max-width: 1000px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #8b5cf6;
            font-size: 2.5em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .star-icon {
            color: #fbbf24;
            font-size: 1.2em;
        }
        
        .subtitle {
            color: #6b7280;
            font-size: 1.2em;
            margin-top: 10px;
        }
        
        /* Character Map Section */
        .character-map {
            background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .character-map-title {
            font-size: 2em;
            color: #8b5cf6;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .character-map-subtitle {
            color: #6b7280;
            font-size: 1.1em;
            margin-bottom: 30px;
        }
        
        .characters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        
        /* Character row fix: force 4 cards in one row on desktop */
        .characters-grid{
            grid-template-columns: repeat(4, minmax(0, 1fr));
        }
        .characters-grid .character-card{
            width: 100%;
            max-width: 220px; /* keeps 4 across on most desktop widths */
        }
        @media (max-width: 1100px){
            .characters-grid{
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
            .characters-grid .character-card{ max-width: 320px; }
        }
        @media (max-width: 700px){
            .characters-grid{
                grid-template-columns: 1fr;
            }
            .characters-grid .character-card{ max-width: 420px; }
        }
.character-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
            overflow: visible;
        }
        
        .character-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }
        
        .character-illustration {
            margin-bottom: 15px;
            transition: transform 0.3s;
        }
        
        .character-card:hover .mia-rest {
            opacity: 0;
        }
        
        .character-card:hover .mia-jump-state {
            opacity: 1;
            animation: mia-power-jump 0.8s ease-in-out;
        }
        
        .mia-jump-state {
            opacity: 0;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        .character-card:hover .door-glitter {
            animation: door-sparkle 1s ease-in-out infinite;
        }
        
        .character-card:hover .butterfly-flutter {
            animation: flutter 0.5s ease-in-out infinite;
        }
        
        .character-card:hover .tree-jump {
            animation: tree-bounce 0.6s ease-in-out;
        }
        
        @keyframes mia-power-jump {
            0% { transform: translateY(0) scaleY(1); }
            15% { transform: translateY(-3px) scaleY(0.9) scaleX(1.05); }
            40% { transform: translateY(-50px) scaleY(1.1) scaleX(0.95); }
            55% { transform: translateY(-55px) scaleY(1.08) scaleX(0.97); }
            70% { transform: translateY(-30px) scaleY(1.05) scaleX(0.98); }
            85% { transform: translateY(-5px) scaleY(0.95) scaleX(1.02); }
            100% { transform: translateY(0) scaleY(1) scaleX(1); }
        }
        
        @keyframes door-sparkle {
            0%, 100% { transform: scale(1) rotate(0deg); filter: brightness(1); }
            25% { transform: scale(1.05) rotate(2deg); filter: brightness(1.3); }
            50% { transform: scale(1.1) rotate(0deg); filter: brightness(1.5); }
            75% { transform: scale(1.05) rotate(-2deg); filter: brightness(1.3); }
        }
        
        @keyframes flutter {
            0%, 100% { transform: translateX(0) translateY(0) rotate(0deg); }
            25% { transform: translateX(-3px) translateY(-5px) rotate(-10deg); }
            50% { transform: translateX(3px) translateY(-3px) rotate(10deg); }
            75% { transform: translateX(-2px) translateY(-7px) rotate(-5deg); }
        }
        
        @keyframes tree-bounce {
            0%, 100% { transform: translateY(0) scale(1); }
            30% { transform: translateY(-30px) scale(1.05); }
            50% { transform: translateY(-35px) scale(1.08); }
            70% { transform: translateY(-25px) scale(1.03); }
            85% { transform: translateY(-10px) scale(1.01); }
        }
        
        .character-name {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .character-subtitle {
            font-size: 0.9em;
            opacity: 0.7;
            margin-bottom: 10px;
        }
        
        .character-tags {
            display: flex;
            gap: 5px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .tag {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.75em;
            font-weight: bold;
            color: white;
        }
        
        /* Story Sections */
        .story-section {
            background: #f8f9ff;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 3px solid #8b5cf6;
        }
        
        .scene-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.3em;
            font-weight: bold;
            color: white;
            margin-bottom: 15px;
        }
        
        .scene-1 .scene-number { background: #ec4899; }
        .scene-2 .scene-number { background: #3b82f6; }
        .scene-3 .scene-number { background: #10b981; }
        .scene-4 .scene-number { background: #f59e0b; }
        
        .story-title {
            font-size: 1.8em;
            margin-bottom: 15px;
        }
        
        .scene-1 .story-title { color: #ec4899; }
        .scene-2 .story-title { color: #3b82f6; }
        .scene-3 .story-title { color: #10b981; }
        .scene-4 .story-title { color: #f59e0b; }
        
        .story-text {
            font-size: 1.3em;
            line-height: 1.8;
            color: #4b5563;
            margin-bottom: 25px;
        }
        
        .reading-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.4);
        }
        
        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }
        
        .btn-secondary:hover {
            background: #d1d5db;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Quiz Section */
        .quiz-section {
            background: #fff7ed;
            border-radius: 20px;
            padding: 30px;
            border: 3px solid #f59e0b;
        }
        
        .quiz-title {
            color: #f59e0b;
            font-size: 1.8em;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .question {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid #fbbf24;
        }
        
        .question-text {
            font-size: 1.2em;
            color: #374151;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .option {
            background: #fef3c7;
            padding: 15px 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            font-size: 1.1em;
        }
        
        .option:hover {
            background: #fde68a;
            transform: translateX(5px);
        }
        
        .option.selected {
            background: #fbbf24;
            border-color: #f59e0b;
            color: white;
            font-weight: bold;
        }
        
        .option.correct {
            background: #10b981;
            border-color: #059669;
            color: white;
            font-weight: bold;
        }
        
        .option.incorrect {
            background: #ef4444;
            border-color: #dc2626;
            color: white;
            font-weight: bold;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            display: block;
            margin: 20px auto 0;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(245, 158, 11, 0.4);
        }
        
        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .score-display {
            text-align: center;
            margin-top: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-radius: 20px;
        }
        
        .score-text {
            font-size: 2em;
            color: #f59e0b;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .stars {
            font-size: 3em;
            color: #fbbf24;
        }
        
        .hidden {
            display: none;
        }
        
        /* Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
        
        .sparkle {
            animation: sparkle 2s ease-in-out infinite;
        }
    
        /* ---------- Improvements: toolbar + progress + accessibility ---------- */
        .toolbar{
            display:flex;
            gap:10px;
            justify-content:center;
            flex-wrap:wrap;
            margin-top:18px;
        }
        .tool-btn{
            padding:10px 16px;
            border-radius:999px;
            border:2px solid #e5e7eb;
            background:#fff;
            color:#374151;
            font-weight:800;
            cursor:pointer;
            transition:transform .15s, box-shadow .15s, background .15s;
            font-family:inherit;
        }
        .tool-btn:hover{ transform: translateY(-1px); box-shadow:0 8px 16px rgba(0,0,0,0.12); }
        .tool-btn:active{ transform: translateY(0px); }
        .tool-primary{
            border-color:#8b5cf6;
            background:linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
            color:#fff;
        }

        .progress-wrap{
            background: linear-gradient(135deg, #eef2ff 0%, #fff 100%);
            border:2px solid #c7d2fe;
            border-radius:18px;
            padding:16px 18px;
            margin: 0 0 18px 0;
        }
        .progress-header{
            display:flex;
            justify-content:space-between;
            align-items:center;
            margin-bottom:10px;
            color:#4b5563;
            font-weight:800;
        }
        .progress-track{
            width:100%;
            height:14px;
            border-radius:999px;
            background:#e5e7eb;
            overflow:hidden;
        }
        .progress-fill{
            height:100%;
            border-radius:999px;
            background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
            transition: width .35s ease;
        }

        /* Tap/keyboard friendly "hover" fallback */
        .character-card:focus-within,
        .character-card.active{
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }
        .character-card.active .mia-rest,
        .character-card:focus-within .mia-rest{ opacity:0; }
        .character-card.active .mia-jump-state,
        .character-card:focus-within .mia-jump-state{
            opacity:1;
            animation: mia-power-jump 0.8s ease-in-out;
        }

        /* Reading mode */
        :root{ --story-font-size: 1.3em; }
        .story-text{ font-size: var(--story-font-size); }
        body.dyslexia-mode{
            font-family: Arial, Verdana, Tahoma, sans-serif;
            letter-spacing: 0.2px;
        }
        body.dyslexia-mode .story-text{
            line-height: 1.9;
        }

        
        /* ---------- Improvements v2: voice picker + corner layout + scene images ---------- */
        .voice-label{
            display:flex;
            align-items:center;
            gap:8px;
            padding:6px 10px;
            border-radius:999px;
            border:2px solid #e5e7eb;
            background:#fff;
            font-weight:800;
            color:#374151;
        }
        .voice-select{
            border:none;
            background:transparent;
            font-family:inherit;
            font-weight:800;
            color:#374151;
            outline:none;
            max-width: 220px;
        }

        /* Character grid layout (ordered, non-overlapping) */
        .characters-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 40px;
            align-items: start;
            justify-items: center;
            margin-top: 30px;
        }

        @media (max-width: 900px){
            .characters-grid{
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
            }
        }
            .characters-grid{
                display:grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
                min-height:auto;
            }
            .characters-grid .character-card{
                position: relative;
                width: auto;
            }
        }

        /* Scene illustration block */
        .scene-layout{
            display:flex;
            gap:22px;
            align-items:flex-start;
        }
        .scene-visual{
            width: 260px;
            flex: 0 0 260px;
            border-radius: 18px;
            background: #fff;
            border: 2px solid rgba(0,0,0,0.06);
            box-shadow: 0 10px 24px rgba(0,0,0,0.08);
            padding: 14px;
        }
        .scene-visual .caption{
            margin-top: 10px;
            font-weight: 800;
            color:#6b7280;
            font-size: 0.95em;
            text-align:center;
        }
        .scene-textcol{ flex: 1; }

        @media (max-width: 750px){
            .scene-layout{ flex-direction:column; }
            .scene-visual{ width:100%; flex: 0 0 auto; }
        }
/* Better focus ring */
        button:focus-visible, .character-card:focus-visible{
            outline: 4px solid rgba(139,92,246,0.45);
            outline-offset: 3px;
        }

        @media (max-width: 600px){
            .container{ padding:24px; }
            .story-text{ line-height:1.75; }
            .btn{ width:100%; }
            .reading-controls{ flex-direction:column; }
        }

        /* ---------- FINAL OVERRIDE: force 4 characters in one row (desktop) ---------- */
        .characters-grid{
            display: grid !important;
            grid-template-columns: repeat(4, minmax(0, 1fr)) !important;
            gap: 28px !important;
            align-items: start !important;
            justify-items: center !important;
            margin-top: 30px !important;
        }
        .characters-grid .character-card{
            width: 100% !important;
            max-width: 230px !important;
        }

        /* Keep 4-across down to typical laptop widths */
        @media (max-width: 1000px){
            .characters-grid{
                grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
                gap: 20px !important;
            }
            .characters-grid .character-card{ max-width: 320px !important; }
        }
        @media (max-width: 650px){
            .characters-grid{
                grid-template-columns: 1fr !important;
            }
            .characters-grid .character-card{ max-width: 420px !important; }
        }

        
        
        
        /* ---------- Tag layout fix v3: shrink text so 2 + 1 always fits ---------- */
        .character-tags{
            display: flex !important;
            flex-direction: row !important;
            flex-wrap: wrap !important;
            justify-content: center !important;
            align-items: center !important;
            gap: 8px !important;
            max-width: 200px !important; /* matches Mia layout */
            margin-left: auto !important;
            margin-right: auto !important;
        }
        .character-tags .tag{
            font-size: 0.8em !important; /* shrink text */
            padding: 6px 14px !important;
            white-space: nowrap !important;
        }

        /* ---------- Targeted fix: Door pills match Mia (2 on top, 1 below) ---------- */
        .characters-grid .character-card:nth-child(2) .character-tags{
            display: flex !important;
            flex-direction: row !important;
            flex-wrap: wrap !important;
            justify-content: center !important;
            gap: 10px !important;
            max-width: 220px !important; /* enough for "Mysterious" */
            margin-left: auto !important;
            margin-right: auto !important;
        }
        .characters-grid .character-card:nth-child(2) .character-tags .tag{
            flex: 0 0 calc(50% - 10px) !important; /* guarantees 2 per row */
            text-align: center !important;
            font-size: 0.82em !important; /* slight shrink for long words */
            padding: 8px 12px !important;
            white-space: nowrap !important;
            justify-content: center !important;
        }
        /* Make the 3rd tag take its own row and center */
        .characters-grid .character-card:nth-child(2) .character-tags .tag:nth-child(3){
            flex-basis: 70% !important;
        }

        /* ---------- Door adjectives: smaller text (final) ---------- */
        .characters-grid .character-card:nth-child(2) .character-tags .tag{
            font-size: 0.7em !important;
            padding: 6px 12px !important;
        }

        /* ---------- Interactive Mia hover (stand -> jump) ---------- */
        .mia-wrapper {
            position: relative;
            width: 180px;
            height: 220px;
            margin: 0 auto;
        }
        .mia {
            position: absolute;
            left: 50%;
            bottom: 0;
            transform: translateX(-50%);
            width: 100%;
            transition: opacity 0.25s ease, transform 0.25s ease;
        }
        .mia-stand { opacity: 1; }
        .mia-jump {
            opacity: 0;
            transform: translateX(-50%) translateY(10px);
        }
        .character-card:hover .mia-stand { opacity: 0; }
        .character-card:hover .mia-jump {
            opacity: 1;
            transform: translateX(-50%) translateY(-12px);
        }

